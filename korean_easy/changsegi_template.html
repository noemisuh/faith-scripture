<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ì°½ì„¸ê¸° __CH__ì¥ | ì‰¬ìš´ì„±ê²½</title>
<style>
  :root{--text:#222;--line:#e6e6e6;--panel:#fafafa;--page-max:1440px;--page-pad:20px;--bar-max:1200px;--bar-pad:16px;}
  body{margin:0;background:#fff;color:var(--text);font-family:"Malgun Gothic",sans-serif;-webkit-user-select:none;user-select:none;}
  .top-space{height:48px;}
  .bar{max-width:var(--bar-max);margin:0 auto;padding:0 var(--bar-pad);}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;}
  .left,.right{display:flex;align-items:center;gap:8px;}
  .icon{font-size:18px}
  .book{width:140px;padding:6px 8px;border:1px solid #ccc;border-radius:4px;}
  .chap{width:60px;padding:6px 8px;border:1px solid #ccc;border-radius:4px;text-align:center;}
  .search{width:180px;padding:6px 8px;border:1px solid #ccc;border-radius:4px;}
  .search2{width:200px;padding:6px 8px;border:1px solid #ccc;border-radius:4px;}
  .divider{border:0;border-top:1px solid var(--line);margin:12px 0 18px;}
  .page{width:min(92vw,var(--page-max));margin:0 auto;padding:0 var(--page-pad);}
  .title-band{display:flex;justify-content:center;margin-bottom:14px;}
  .title-pack{display:inline-block;text-align:center;}
  .title-pack h1{margin:0;font-size:28px;font-weight:800;line-height:1;}
  .nav-under{display:flex;justify-content:space-between;gap:8px;margin-top:8px;}
  .nav-btn{border:none;background:transparent;color:#888;font-size:20px;cursor:pointer;}
  .wrap{max-width:1200px;margin:0 auto 90px;display:flex;gap:24px;align-items:flex-start;}
  .col-left{flex:7;min-width:0}
  .col-right{flex:3;min-width:280px;display:flex;flex-direction:column;gap:14px}
  .version{font-weight:800;margin:2px 0 12px;display:inline-flex;align-items:center;gap:6px}
  .tip{position:relative;display:inline-block;cursor:help;font-weight:700;border:1px solid #bbb;border-radius:50%;width:18px;height:18px;line-height:16px;text-align:center;font-size:12px;color:#555;}
  .tip:hover::after{content:"ë§ì”€: ë‚˜ì¤‘ì— ì±„ì›€\aí•„ì‚¬ì¹¸: ë¶™ì—¬ë„£ê¸° ë°©ì§€\aë³´ì¡°ì¹¸: ììœ í¸ì§‘, â–²â–¼ë¡œ ë†’ì´ ì¡°ì ˆ";white-space:pre;position:absolute;left:22px;top:-4px;background:#333;color:#fff;padding:8px 10px;border-radius:6px;font-size:12px;z-index:10;}
  .panel{background:var(--panel);border:1px solid #d8d8d8;border-radius:8px;overflow:hidden}
  .panel .ph{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid #eaeaea;background:#f6f6f6;font-weight:700;font-size:13px}
  .panel .ph .btns button{border:none;background:transparent;cursor:pointer;font-size:12px;color:#666;padding:2px 4px}
  .panel .body{padding:10px;min-height:100px}
  .panel .body[contenteditable="true"]{outline:none}
  #archive{height:140px}
  #libre{min-height:280px}
  .placeholder{padding:12px;border:1px dashed #cfcfcf;border-radius:8px;color:#888;background:#fcfcfc}
  textarea{width:100%;height:40px;margin-top:8px;padding:8px;font-size:15px;line-height:1.5;border:1px solid #cfcfcf;border-radius:6px;resize:vertical;font-family:inherit;}
  textarea:focus{outline:2px solid #a9c7ff}
  /* ë§ˆì´í¬ + ë§í’ì„  */
  .mic{position:fixed;right:24px;bottom:24px;width:54px;height:54px;border:none;border-radius:50%;background:#2f2f2f;color:#fff;font-size:24px;box-shadow:0 6px 16px rgba(0,0,0,.25);cursor:pointer;z-index:999}
  .bubble{position:fixed;right:90px;bottom:32px;max-width:320px;background:#111;color:#fff;border-radius:12px;padding:8px 10px;font-size:13px;line-height:1.4;display:none;z-index:1000}
  .bubble.show{display:block}
</style>
</head>
<body oncontextmenu="return false" ondragstart="return false">
<div class="top-space"></div>

<div class="bar">
  <div class="topbar">
    <div class="left">
      <span class="icon">ğŸ“–</span>
      <input class="book" type="text" value="ì°½ì„¸ê¸°" readonly>
      <input class="chap" id="chapInput" type="text" value="__CH__" readonly>
    </div>
    <div class="right">
      <span class="icon">ğŸ”</span>
      <input class="search"  type="text" placeholder="ë³¸ë¬¸ ê²€ìƒ‰">
      <input class="search2" type="text" placeholder="ì˜ˆ) ì‹­ìê°€ / ë¶€í™œ">
    </div>
  </div>
  <hr class="divider">
</div>

<div class="page">
  <div class="title-band">
    <div class="title-pack">
      <h1>ì°½ì„¸ê¸° <span id="chLabel">__CH__</span>ì¥</h1>
      <div class="nav-under">
        <button class="nav-btn" id="prevBtn" aria-label="ì´ì „ ì¥">â†</button>
        <button class="nav-btn" id="nextBtn" aria-label="ë‹¤ìŒ ì¥">â†’</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="col-left">
      <div class="version">ì‰¬ìš´ì„±ê²½ <span class="tip">?</span></div>
      <div id="verses" class="placeholder">
        â€» ì´ ì¥ì˜ ë§ì”€ì€ ì•„ì§ ë¹„ì›Œë‘ì—ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ê° ì ˆì„ ì¶”ê°€í•˜ê³  í•„ì‚¬ì¹¸ì„ ë¶™ì—¬ ë„£ìœ¼ì„¸ìš”.
      </div>
      <!-- í•„ìš” ì‹œ ì—¬ê¸°ì— ê° ì ˆ + textarea êµ¬ì¡°ë¥¼ ì´í›„ì— ì±„ì›ë‹ˆë‹¤ -->
    </div>

    <aside class="col-right">
      <section id="archive" class="panel">
        <div class="ph">ì•„ì¹´ì´ë¸Œ
          <div class="btns">
            <button type="button" data-delta="-40" title="ìœ„ë¡œ ì¤„ì´ê¸°">â–²</button>
            <button type="button" data-delta="40"  title="ì•„ë˜ë¡œ ëŠ˜ë¦¬ê¸°">â–¼</button>
          </div>
        </div>
        <div class="body" id="archiveBody" contenteditable="true" spellcheck="false"></div>
      </section>

      <section id="libre" class="panel">
        <div class="ph">ë¦¬ë¸Œë ˆ(ììœ  ë©”ëª¨)</div>
        <div class="body" id="libreBody" contenteditable="true" spellcheck="false"></div>
      </section>
    </aside>
  </div>
</div>

<button class="mic" id="micBtn" title="ìŒì„± ì…ë ¥">ğŸ¤</button>
<div class="bubble" id="bubble">ë§ˆì´í¬ë¥¼ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.</div>

<script>
  // ë¶™ì—¬ë„£ê¸° ë°©ì§€(ì…ë ¥/í¸ì§‘ ì˜ì—­)
  document.addEventListener('paste', (e)=>{
    const t = e.target;
    if (!t) return;
    if (t.tagName === 'TEXTAREA' || t.tagName === 'INPUT' || t.isContentEditable) e.preventDefault();
  });

  // íŒŒì¼ëª…ì—ì„œ ì¥ ë²ˆí˜¸ ì¶”ì¶œ (â€¦/changsegiNNN.html)
  const m = location.pathname.match(/changsegi(\d{3})\.html$/);
  const ch = m ? parseInt(m[1],10) : parseInt(document.getElementById('chapInput').value,10) || 1;
  document.getElementById('chLabel').textContent = ch;
  const chapInput = document.getElementById('chapInput'); if (chapInput) chapInput.value = ch;

  // ì œëª© ì•„ë˜ ì¤‘ì•™ í™”ì‚´í‘œ
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const fileOf = (n)=> `changsegi${String(n).padStart(3,'0')}.html`;
  const dir  = location.pathname.replace(/[^/]+$/, '');       // â€¦/korean_easy/
  const root = dir.replace(/korean_easy\/$/, '');             // ë£¨íŠ¸

  prevBtn.onclick = ()=> { if (ch <= 1) location.href = root + 'index.html'; else location.href = dir + fileOf(ch-1); };
  nextBtn.onclick = ()=> { location.href = dir + fileOf(ch+1); };

  // ì•„ì¹´ì´ë¸Œ ë†’ì´ ì¡°ì ˆ
  (function(){
    const arch = document.getElementById('archive');
    document.querySelectorAll('#archive .btns button').forEach(b=>{
      b.addEventListener('click', ()=>{
        const d = parseInt(b.dataset.delta,10);
        const h = Math.max(80, arch.offsetHeight + d);
        arch.style.height = h + 'px';
      });
    });
  })();

  // ìë™ ì €ì¥/ë³µì› (ìš°ì¸¡ íŒ¨ë„ + ì¢Œì¸¡ ì¶”í›„ textarea)
  function key(v){ return `korean_easy:genesis:${String(ch).padStart(3,'0')}:${v}`; }
  ['archiveBody','libreBody'].forEach(id=>{
    const el = document.getElementById(id);
    const k = key(id);
    const saved = localStorage.getItem(k);
    if (saved !== null) el.innerHTML = saved;
    el.addEventListener('input', ()=> localStorage.setItem(k, el.innerHTML));
  });
  function bindTextareaAutosave(rootEl=document){
    rootEl.querySelectorAll('textarea').forEach((ta, i)=>{
      const k = key('v'+(ta.dataset.verse || (i+1)));
      const saved = localStorage.getItem(k);
      if (saved !== null) ta.value = saved;
      ta.addEventListener('input', ()=> localStorage.setItem(k, ta.value));
    });
  }
  bindTextareaAutosave();

  // ë§ˆì´í¬ + ë§í’ì„ 
  const micBtn  = document.getElementById('micBtn');
  const bubble  = document.getElementById('bubble');
  let recog = null;

  function show(msg){
    bubble.textContent = msg;
    bubble.classList.add('show');
    clearTimeout(show._t);
    show._t = setTimeout(()=> bubble.classList.remove('show'), 2000);
  }
  function activeEditable(){
    const t = document.activeElement;
    if (!t) return null;
    if (t.tagName === 'TEXTAREA') return t;
    if (t.isContentEditable)     return t;
    show('í•„ì‚¬ì¹¸ ë˜ëŠ” ìš°ì¸¡ ë©”ëª¨ì¹¸ì„ í´ë¦­í•œ ë’¤ ë§ˆì´í¬ë¥¼ ëˆ„ë¥´ì„¸ìš”.');
    return null;
  }
  function ensureRecog(){
    const R = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!R){ show('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return null; }
    const r = new R();
    r.lang='ko-KR'; r.interimResults=false; r.continuous=false; r.maxAlternatives=1;
    r.onstart = ()=> show('ë…¹ìŒ ì¤‘â€¦');
    r.onerror = (e)=> show('ì˜¤ë¥˜: ' + (e.error||'unknown'));
    r.onend   = ()=> {};
    r.onresult = (ev)=>{
      const tgt = activeEditable(); if(!tgt) return;
      const txt = ev.results[0][0].transcript;
      if (tgt.tagName === 'TEXTAREA'){
        const needsSpace = tgt.value && !/\s$/.test(tgt.value);
        const pos = tgt.selectionStart ?? tgt.value.length;
        const ins = (needsSpace?' ':'') + txt;
        tgt.setRangeText(ins, pos, pos, 'end');
        tgt.dispatchEvent(new Event('input'));
      }else{ // contentEditable
        document.execCommand('insertText', false, txt + ' ');
        const id = tgt.id || 'contentEditable';
        localStorage.setItem(key(id), tgt.innerHTML);
      }
      show('ë°›ì•„ì“°ê¸°: ' + txt.slice(0,32) + (txt.length>32?'â€¦':''));
    };
    return r;
  }
  micBtn.addEventListener('click', ()=>{
    const tgt = activeEditable(); if(!tgt) return;
    if (!recog) recog = ensureRecog();
    if (recog) try{ recog.start(); }catch(_){}
  });
</script>
</body>
</html>
