<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>창세기 2장 | 쉬운성경</title>
<style>
  :root{
    --text:#222;--line:#e6e6e6;--panel:#fafafa;--page-max:1440px;--page-pad:20px;--bar-max:1200px;--bar-pad:16px;
    /* ★ 2장 기준 아카이브 고정폭 */
    --archive-width:720px;
  }
  body{margin:0;background:#fff;color:var(--text);font-family:"Malgun Gothic",sans-serif;-webkit-user-select:none;user-select:none;}
  /* ★ 상단 칸(1장 기준) */
  .top-space{height:48px;}

  .bar{max-width:var(--bar-max);margin:0 auto;padding:0 var(--bar-pad);}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;}
  .left,.right{display:flex;align-items:center;gap:8px;}
  .icon{font-size:18px;}
  /* ★ 흰색 검색 아이콘(1장과 동일) */
  .icon.search-icon{
    display:inline-flex;align-items:center;justify-content:center;
    width:28px;height:28px;border-radius:6px;
    background:#222;color:#fff;
  }
  .icon.search-icon svg{width:18px;height:18px;display:block;}

  /* ★ 목차·검색 폭(1장 기준) */
  .book{width:105px;padding:6px 8px;border:1px solid #ccc;border-radius:4px}
  .chap{width:30px; padding:6px 8px;border:1px solid #ccc;border-radius:4px;text-align:center}
  .search{width:120px;padding:6px 8px;border:1px solid #ccc;border-radius:4px}
  .search2{width:134px;padding:6px 8px;border:1px solid #ccc;border-radius:4px}

  .divider{border:0;border-top:1px solid var(--line);margin:12px 0 18px;}
  .page{width:min(92vw,var(--page-max));margin:0 auto;padding:0 var(--page-pad);}
  .title-band{display:flex;justify-content:center;margin-bottom:14px;}
  .title-pack{display:inline-block;text-align:center;}
  .title-pack h1{margin:0;font-size:28px;font-weight:800;line-height:1;}
  /* ★ 화살표는 중앙 정렬(1장과 동일) */
  .nav-under{display:flex;justify-content:center;gap:24px;margin-top:8px}
  .nav-btn{border:none;background:transparent;color:#888;font-size:20px;cursor:pointer}
  .nav-btn:focus{outline:2px solid #cfe0ff;border-radius:6px}

  /* ★ 레이아웃: 본문 1fr | 아카이브 고정폭 */
  .wrap{
    max-width:1200px;margin:0 auto 90px;
    display:grid;grid-template-columns: 1fr var(--archive-width);
    gap:24px;align-items:flex-start;
  }
  .col-left{min-width:0}
  aside.col-right{width:var(--archive-width)}
  @media (max-width:960px){
    .wrap{grid-template-columns:1fr}
    aside.col-right{width:auto}
  }

  .version{display:block;margin:2px 0 12px;text-align:left}
  .tip{position:relative;display:inline-block;cursor:help;font-weight:700;border:1px solid #bbb;border-radius:50%;width:18px;height:18px;line-height:16px;text-align:center;font-size:12px;color:#555;}
  .tip:hover::after{content:"말씀: 나중에 채움\a필사칸: 붙여넣기 방지\a보조칸: 자유편집, ▲▼로 높이 조절";white-space:pre;position:absolute;left:22px;top:-4px;background:#333;color:#fff;padding:8px 10px;border-radius:6px;font-size:12px;z-index:10;}

  .panel{background:var(--panel);border:1px solid #d8d8d8;border-radius:8px;overflow:hidden}
  .panel .ph{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid #eaeaea;background:#f6f6f6;font-weight:700;font-size:13px}
  .panel .ph .btns button{border:none;background:transparent;cursor:pointer;font-size:12px;color:#666;padding:2px 4px}
  .panel .body{padding:10px;min-height:100px}
  .panel .body[contenteditable="true"]{outline:none}

  /* ★ 아카이브 높이 초기값(1장과 동일) */
  #archive{height:140px}
  #libre{min-height:280px}

  /* 마이크 버튼(1장과 동일) */
  .mic{position:fixed;right:24px;bottom:24px;width:54px;height:54px;border:none;border-radius:50%;background:#2f2f2f;color:#fff;font-size:24px;box-shadow:0 6px 16px rgba(0,0,0,.25);cursor:pointer;z-index:999}

  .placeholder{padding:12px;border:1px dashed #cfcfcf;border-radius:8px;color:#888;background:#fcfcfc}
  textarea{width:100%;height:40px;margin-top:8px;padding:8px;font-size:15px;line-height:1.5;border:1px solid #cfcfcf;border-radius:6px;resize:vertical;font-family:inherit;}
  textarea:focus{outline:2px solid #a9c7ff}
</style>
</head>
<body oncontextmenu="return false" ondragstart="return false">
<div class="top-space"></div>

<div class="bar">
  <div class="topbar">
    <div class="left">
      <span class="icon">📖</span>
      <input class="book" type="text" value="창세기" readonly>
      <input class="chap" type="text" value="2" readonly>
    </div>
    <div class="right">
      <!-- ★ 흰색 SVG 돋보기 -->
      <span class="icon search-icon" aria-hidden="true" title="본문 검색">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>
        </svg>
      </span>
      <input class="search"  type="text" placeholder="본문 검색">
      <input class="search2" type="text" placeholder="예) 십자가 / 부활">
    </div>
  </div>
  <hr class="divider">
</div>

<div class="page">
  <div class="title-band">
    <div class="title-pack">
      <h1>창세기 2장</h1>
      <div class="nav-under">
        <button class="nav-btn" id="prevBtn" aria-label="changsegi001" type="button">←</button>
        <button class="nav-btn" id="nextBtn" aria-label="changsegi003" type="button">→</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="col-left">
      <div class="version">쉬운성경 <span class="tip">?</span></div>
      <div id="verses" class="placeholder">
        ※ 이 장의 말씀은 아직 비워두었습니다. 나중에 각 절을 추가하고 필사칸을 붙여 넣으세요.
      </div>
    </div>

    <aside class="col-right">
      <section id="archive" class="panel">
        <div class="ph">아카이브
          <div class="btns">
            <button type="button" data-delta="-40" title="위로 줄이기">▲</button>
            <button type="button" data-delta="40"  title="아래로 늘리기">▼</button>
          </div>
        </div>
        <!-- ★ 자동저장 위해 id 부여 -->
        <div class="body" id="archiveBody" contenteditable="true" spellcheck="false"></div>
      </section>

      <section id="libre" class="panel">
        <div class="ph">리브레(자유 메모)</div>
        <!-- ★ 자동저장 위해 id 부여 -->
        <div class="body" id="libreBody" contenteditable="true" spellcheck="false"></div>
      </section>
    </aside>
  </div>
</div>

<button class="mic" id="micBtn" title="음성 입력">🎤</button>

<script>
(() => {
  // ===== 붙여넣기 방지(입력/편집 영역만) =====
  document.addEventListener('paste', (e) => {
    const t = e.target;
    if (t && (t.tagName === 'TEXTAREA' || t.tagName === 'INPUT' || t.isContentEditable)) {
      e.preventDefault();
    }
  });

  // ===== 아카이브 높이 조절 =====
  const arch = document.getElementById('archive');
  if (arch) {
    arch.querySelectorAll('.btns button').forEach((b) => {
      b.addEventListener('click', () => {
        const d = parseInt(b.dataset.delta || '0', 10);
        const h = Math.max(80, arch.offsetHeight + d);
        arch.style.height = h + 'px';
      });
    });
  }

  // ===== 장 번호/경로 (1장과 동일한 방식)
  const m   = location.pathname.match(/changsegi(\d{3})\.html$/);
  const ch  = m ? parseInt(m[1],10) : 2;
  const dir = location.pathname.replace(/[^/]+$/, '');   // …/korean_easy/
  const root= dir.replace(/korean_easy\/$/, '');         // 루트
  const fileOf = (n) => `changsegi${String(n).padStart(3,'0')}.html`;

  // ← / → : aria-label 또는 기본 규칙
  function linkify(btn, fallback) {
    if (!btn) return fallback;
    let raw = (btn.dataset.href || btn.getAttribute('aria-label') || '').trim();
    if (!raw) return fallback;
    raw = raw.replace(/^\//,'').replace(/\.html$/i,'');
    if (raw === 'index') return root + 'index.html';
    if (/^https?:\/\//i.test(raw)) return raw;
    return dir + raw + '.html';
  }
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  if (prevBtn) prevBtn.onclick = () =>
    location.href = linkify(prevBtn, ch <= 1 ? root + 'index.html' : dir + fileOf(ch-1));
  if (nextBtn) nextBtn.onclick = () =>
    location.href = linkify(nextBtn, dir + fileOf(ch+1));

  // ===== 자동 저장/복원(우측 패널 + 추후 textarea)
  const key = (v) => `korean_easy:genesis:${String(ch).padStart(3,'0')}:${v}`;

  ['archiveBody','libreBody'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    const saved = localStorage.getItem(key(id));
    if (saved !== null) el.innerHTML = saved;
    el.addEventListener('input', () => localStorage.setItem(key(id), el.innerHTML));
  });

  (function bindTA(root=document){
    root.querySelectorAll('textarea').forEach((ta,i)=>{
      const k = key('v' + (ta.dataset.verse || (i+1)));
      const saved = localStorage.getItem(k);
      if (saved !== null) ta.value = saved;
      ta.addEventListener('input', () => localStorage.setItem(k, ta.value));
    });
  })();

  // ===== 마이크
  const micBtn = document.getElementById('micBtn');
  if (micBtn){
    micBtn.addEventListener('click', ()=>{
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR){ alert('이 브라우저는 음성 인식을 지원하지 않습니다.'); return; }
      const rec = new SR();
      rec.lang='ko-KR'; rec.interimResults=false; rec.continuous=false; rec.maxAlternatives=1;

      rec.onerror = e => console.warn('STT error:', e.error||e);
      rec.onresult= e => {
        const t = document.activeElement;
        const txt = e.results[0][0].transcript;
        if (t && t.tagName==='TEXTAREA'){
          const needsSpace = t.value && !/\s$/.test(t.value);
          const pos = t.selectionStart ?? t.value.length;
          t.setRangeText((needsSpace?' ':'')+txt, pos, pos, 'end');
          t.dispatchEvent(new Event('input'));
        } else if (t && t.isContentEditable){
          document.execCommand('insertText', false, txt+' ');
        } else {
          alert('필사칸/메모칸을 클릭한 뒤 마이크를 눌러주세요.');
        }
      };
      try{ rec.start(); }catch(_){}
    });
  }
})();
</script>
</body>
</html>
